<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Secure flask-admin using flask-basicauth</title>
    <meta name="description" content="A description that will appear as a default if front matter does not exist" />
    <meta name="keywords" content='web,guide,python,flask' />
    
    
    <link href="" rel="alternate" type="application/rss+xml" title="Computable(verse)" />
    <link href="https://fonts.googleapis.com/css?family=Merriweather" rel="stylesheet">
    <link rel="stylesheet" href="http://computableverse.com/css/normalize.css" />
    <link rel="stylesheet" href="http://computableverse.com/css/sakura.css" />
    <link rel="stylesheet" href="http://computableverse.com/css/custom.css" />
    <meta property="og:title" content="Secure flask-admin using flask-basicauth" />
<meta property="og:description" content="I could not find a way to protect my flask-admin installation at /admin using Flask-BasicAuth, so I decided to write this for future explorers!

" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://computableverse.com/blog/flask-admin-using-basicauth/" />


<meta property="og:updated_time" content="2016-07-14T00:00:00&#43;00:00"/>









<meta property="fb:admins" content="100000855963383" />
    
    
<meta itemprop="name" content="Secure flask-admin using flask-basicauth">
<meta itemprop="description" content="I could not find a way to protect my flask-admin installation at /admin using Flask-BasicAuth, so I decided to write this for future explorers!

">


<meta itemprop="dateModified" content="2016-07-14T00:00:00&#43;00:00" />
<meta itemprop="wordCount" content="379">



<meta itemprop="keywords" content="ajax,atom,autocomplete,cors,django,dotfiles,fix,flask,git,guide,https,install,letsencrypt,linux,macos,markdown,neovim,nginx,pandoc,publishing,pypi,python,setup,ssl,stagit,static-site-generators,sysadmin,terminal,testing,text-editors,thoughts,til,ubuntu,vim,web,workflow,zsh," />

    

  <meta name="twitter:card" content="summary"/>



<meta name="twitter:title" content="Secure flask-admin using flask-basicauth"/>
<meta name="twitter:description" content="I could not find a way to protect my flask-admin installation at /admin using Flask-BasicAuth, so I decided to write this for future explorers!

"/>
<meta name="twitter:site" content="@oxalorg"/>
<meta name="twitter:domain" content="computableverse.com"/>

</head>
<body>
    <header class="site-header">
        <h1 class="site-title"> <a href="/">computable<span class="meta">(</span><em>verse</em><span class="meta">)</span></a> {</h1>
        <p class="meta">/* <a href="/about/">about</a> | <a href="/blog/">archive</a> */
        </p>
    </header>
    <section class="site-main">
        <section class="content">
            
<article class="post">
<h1 class="post-title">Secure flask-admin using flask-basicauth</h1>
<p class="meta"> 

<small>
    Posted on <time datetime="2016-07-14T00:00:00Z">July 14, 2016</time>
    by <a href="http://miteshshah.com">Mitesh Shah</a>
    
        
        in <span><a href="http://computableverse.com/tags/web">web</a>, <a href="http://computableverse.com/tags/guide">guide</a>, <a href="http://computableverse.com/tags/python">python</a>, <a href="http://computableverse.com/tags/flask">flask</a></span>
    
</small>
 </p>

<p>I could not find a way to protect my flask-admin installation at <code>/admin</code> using <code>Flask-BasicAuth</code>, so I decided to write this for future explorers!</p>

<p></p>

<p>The flask-admin docs praise the simplicity and awesomeness of using HTTP basic authentication, and also point the user towards a small extenstion which makes this easy process even easier.</p>

<blockquote>
<p>The simplest form of authentication is HTTP Basic Auth. It doesn’t interfere with your database models, and it doesn’t require you to write any new view logic or template code.
Have a look at Flask-BasicAuth to see just how easy it is to put your whole application behind HTTP Basic Auth.</p>
</blockquote>

<p>and then they drop the bomb saying:</p>

<blockquote>
<p>Unfortunately, there is no easy way of applying HTTP Basic Auth just to your admin interface.</p>
</blockquote>

<p>Oh well. I definitely do not want people to log in when they land on my index page, so that rules the above option out.</p>

<p>Thankfully, it&rsquo;s rather quite easy to extend admin views to support <code>flask-BasicAuth</code>. We just need to override two functions in our admin <code>ModelView</code> class.</p>
class ModelView(sqla.ModelView):
    def is_accessible(self):
        if not basic_auth.authenticate():
            raise AuthException('Not authenticated.')
        else:
            return True

    def inaccessible_callback(self, name, **kwargs):
        return redirect(basic_auth.challenge())

<p>Here <code>basic_auth</code> is defined as <code>basic_auth = BasicAuth(app)</code> directly borrowed from the quickstart section of BasicAuth docs.</p>

<p>If <code>BasicAuth</code> can&rsquo;t authenticate the user, it will raise an exception which inturn will call the <code>inaccessible_callback</code> which will challenge the user to provide authentication details.</p>

<p>The exception, <code>AuthException</code>, is nothing but a simple <code>HTTPException</code> provided by <code>werkzeug</code>:</p>
from werkzeug.exceptions import HTTPException

class AuthException(HTTPException):
    def __init__(self, message):
        super().__init__(message, Response(
            "You could not be authenticated. Please refresh the page.", 401,
            {'WWW-Authenticate': 'Basic realm="Login Required"'}
        ))

<p>Now we can call our admin views normally like this:</p>
admin = Admin(app, name='ninjas-nest')
admin.add_view(ModelView(Post, db.session))
admin.add_view(ModelView(PostFiles, db.session))

<p>TADA! All the urls prefixed with <code>/admin</code> now require authentication before you can proceed.</p>

<p>WARNING: Please note that this is not secure on it&rsquo;s own. It will send username and password without any encryption. Only use it with HTTPS (SSL/TLS). Also, this does not block ips which have a lot of failed attempts which could lead to security concerns. I will deal with this in a later post.</p>

<p>Let me know if you have any better way of protecting only <code>flask-admin</code> in the comments below.</p>
</article>
<div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'computableverse';
    var disqus_identifier = 'http:\/\/computableverse.com\/blog\/flask-admin-using-basicauth\/';
    var disqus_title = 'Secure flask-admin using flask-basicauth';
    var disqus_url = 'http:\/\/computableverse.com\/blog\/flask-admin-using-basicauth\/';

    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

        </section>
    </section>
    <footer class="site-footer">
        <h1>}</h1> 
    </footer>
    
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-61533153-1', 'auto');
ga('send', 'pageview');
</script>

</body>
</html>
